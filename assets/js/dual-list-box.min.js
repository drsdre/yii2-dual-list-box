(function(e){e.fn.DualListBox=function(m,n){return this.each(function(){var q={element:e(this).context,id:e(this).context.id,name:e(this).context.id,uri:"local.json",value:"id",text:"name",title:"Example",json:true,timeout:500,horizontal:false,textLength:45,moveAllBtn:true,maxAllBtn:1000,lngOptions:{warning_info:"Are you sure you want to move this many items? Doing so can cause your browser to become unresponsive.",search_placeholder:"Filter",showing:"- showing",available:"Available",selected:"Selected"}};var p={element:e(this).context,id:e(this).data("id"),name:e(this).data("name"),uri:e(this).data("source"),value:e(this).data("value"),text:e(this).data("text"),title:e(this).data("title"),json:e(this).data("json"),timeout:e(this).data("timeout"),horizontal:e(this).data("horizontal"),textLength:e(this).data("textLength"),moveAllBtn:e(this).data("moveAllBtn"),maxAllBtn:e(this).data("maxAllBtn")};var o=e.extend({},q,p,m);var r=o.id;e.each(o,function(s,t){if(t===undefined||t===null){throw"DualListBox: "+s+" is undefined."}});o.id=r;o.parent="dlb-"+r;o.parentElement="#"+o.parent;n=e.extend([{}],n);if(o.json){k(o,n)}else{j(o)}})};function k(o,p){var n=false;if(o.text.indexOf(":")>-1){var m=o.text.split(":");if(m.length>1){n=true}}e.getJSON(o.uri,function(q){e.each(q,function(r,s){var t="";if(n){m.forEach(function(u){t+=s[u]+" "})}else{t=s[o.text]}e("<option>",{value:s[o.value],text:t,selected:(p.some(function(u){return u[o.value]===s[o.value]})===true)}).appendTo(o.element)});j(o)})}function f(m){var n=e(m.parentElement+" .unselected");var o=e(m.parentElement+" .selected");e(m.parentElement).find("button").bind("click",function(){switch(e(this).data("type")){case"str":n.find("option:selected").appendTo(o);e(this).prop("disabled",true);break;case"atr":if(n.find("option").length>=m.maxAllBtn&&confirm(m.lngOptions.warning_info)||n.find("option").length<m.maxAllBtn){n.find("option").each(function(){if(e(this).isVisible()){e(this).remove().appendTo(o)}})}break;case"stl":o.find("option:selected").remove().appendTo(n);e(this).prop("disabled",true);break;case"atl":if(o.find("option").length>=m.maxAllBtn&&confirm(m.lngOptions.warning_info)||o.find("option").length<m.maxAllBtn){o.find("option").each(function(){if(e(this).isVisible()){e(this).remove().appendTo(n)}})}break;default:break}n.filterByText(e(m.parentElement+" .filter-unselected"),m.timeout,m.parentElement).scrollTop(0).sortOptions();o.filterByText(e(m.parentElement+" .filter-selected"),m.timeout,m.parentElement).scrollTop(0).sortOptions();a(m)});e(m.parentElement).closest("form").submit(function(){o.find("option").prop("selected",true)});e(m.parentElement).find('input[type="text"]').keypress(function(p){if(p.which===13){event.preventDefault()}});o.filterByText(e(m.parentElement+" .filter-selected"),m.timeout,m.parentElement).scrollTop(0).sortOptions();n.filterByText(e(m.parentElement+" .filter-unselected"),m.timeout,m.parentElement).scrollTop(0).sortOptions()}function j(m){l(m);c(m);f(m)}function h(n,o){var r=0,m=0,p=new Array();e(n+" .unselected").find("option").each(function(){if(e(this).isVisible()){r++}});e(n+" .selected").find("option").each(function(){if(e(this).isVisible()){p[m]=this.value;m++}});var q=JSON.stringify(p);e("#"+o.name+"-"+o.id).val(q);e(n+" .unselected-count").text(r);e(n+" .selected-count").text(m);i(n)}function l(m){e(m.element).parent().attr("id",m.parent);e(m.parentElement).append('<div class="row">'+(m.horizontal==false?'   <div class="col-md-5">':'   <div class="col-md-6">')+'       <h4><span class="unselected-title"></span> <small>'+m.lngOptions.showing+' <span class="unselected-count"></span></small></h4>       <input class="filter form-control filter-unselected" type="text" placeholder="'+m.lngOptions.search_placeholder+'" style="margin-bottom: 5px;">'+(m.horizontal==false?"":g(1,m.moveAllBtn))+'       <select class="unselected" style="height: 200px; width: 100%;" multiple></select>   </div>'+(m.horizontal==false?b(m.moveAllBtn):"")+(m.horizontal==false?'   <div class="col-md-5">':'   <div class="col-md-6">')+'       <h4><span class="selected-title"></span> <small>'+m.lngOptions.showing+' <span class="selected-count"></span></small></h4>       <input class="filter form-control filter-selected" type="text" placeholder="'+m.lngOptions.search_placeholder+'" style="margin-bottom: 5px;">'+(m.horizontal==false?"":g(2,m.moveAllBtn))+'       <select class="selected" style="height: 200px; width: 100%;" multiple></select>   </div></div>');var n=e(m.parentElement+" .unselected");var o=e(m.parentElement+" .selected");e(m.parentElement+" .selected").prop("name",e(m.element).prop("name"));e(m.parentElement+" .unselected-title").text(m.lngOptions.available+" "+m.title);e(m.parentElement+" .selected-title").text(m.lngOptions.selected+" "+m.title)}function g(n,m){if(n==1){return(m?'       <button type="button" class="btn btn-default atr" data-type="atr" style="margin-bottom: 5px;"><span class="glyphicon glyphicon-chevron-right"></span> <span class="glyphicon glyphicon-chevron-right"></span></button>':"")+'       <button type="button" class="btn btn-default '+(m?"pull-right col-md-6":"col-md-12")+' str" data-type="str" style="margin-bottom: 5px;" disabled><span class="glyphicon glyphicon-chevron-right"></span></button>'}else{return'       <button type="button" class="btn btn-default '+(m?"col-md-6":"col-md-12")+' stl" data-type="stl" style="margin-bottom: 5px;" disabled><span class="glyphicon glyphicon-chevron-left"></span></button>'+(m?'       <button type="button" class="btn btn-default col-md-6 pull-right atl" data-type="atl" style="margin-bottom: 5px;"><span class="glyphicon glyphicon-chevron-left"></span> <span class="glyphicon glyphicon-list"></span></button>':"")}}function b(m){return'   <div class="col-md-2 center-block" style="margin-top: '+(m?"80px":"130px")+'">'+(m?'       <button type="button" class="btn btn-default col-md-8 col-md-offset-2 atr" data-type="atr" style="margin-bottom: 10px;"><span class="glyphicon glyphicon-chevron-right"></span> <span style="margin-left: -10px;" class="glyphicon glyphicon-chevron-right"></span></button>':"")+'       <button type="button" class="btn btn-default col-md-8 col-md-offset-2 str" data-type="str" style="margin-bottom: 20px;" disabled><span class="glyphicon glyphicon-chevron-right"></span></button>       <button type="button" class="btn btn-default col-md-8 col-md-offset-2 stl" data-type="stl" style="margin-bottom: 10px;" disabled><span class="glyphicon glyphicon-chevron-left"></span></button>'+(m?'       <button type="button" class="btn btn-default col-md-8 col-md-offset-2 atl" data-type="atl" style="margin-bottom: 10px;"><span class="glyphicon glyphicon-chevron-left"></span> <span style="margin-left: -10px;" class="glyphicon glyphicon-chevron-left"></span></button>':"")+"   </div>"}function a(m){e(m.parentElement+" .unselected").find("option:selected").prop("selected",false);e(m.parentElement+" .selected").find("option:selected").prop("selected",false);e(m.parentElement+" .filter").val("");e(m.parentElement+" select").find("option").each(function(){e(this).show()});h(m.parentElement,m)}function c(m){var p=false;var n=e(m.parentElement+" .unselected");var o=e(m.parentElement+" .selected");e(m.element).find("option").text(function(q,r){e(this).data("title",r);if(r.length>m.textLength){p=true;return r.substr(0,m.textLength)+"..."}}).each(function(){if(p){e(this).prop("title",e(this).data("title"))}if(e(this).is(":selected")){e(this).appendTo(m.parentElement+" .selected")}else{e(this).appendTo(m.parentElement+" .unselected")}});e(m.element).remove();a(m)}function i(m){e(m+" .unselected").change(function(){e(m+" .str").prop("disabled",false)});e(m+" .selected").change(function(){e(m+" .stl").prop("disabled",false)});if(e(m+" .unselected").has("option").length==0){e(m+" .atr").prop("disabled",true);e(m+" .str").prop("disabled",true)}else{e(m+" .atr").prop("disabled",false)}if(e(m+" .selected").has("option").length==0){e(m+" .atl").prop("disabled",true);e(m+" .stl").prop("disabled",true)}else{e(m+" .atl").prop("disabled",false)}}e.fn.filterByText=function(o,n,m){return this.each(function(){var p=this;var q=[];e(p).find("option").each(function(){q.push({value:e(this).val(),text:e(this).text()})});e(p).data("options",q);e(o).bind("change keyup",function(){d(function(){var r=e(p).data("options");var s=e.trim(e(o).val());var t=new RegExp(s,"gi");e.each(r,function(u){if(r[u].text.match(t)===null){e(p).find(e('option[value="'+r[u].value+'"]')).hide()}else{e(p).find(e('option[value="'+r[u].value+'"]')).show()}});h(m,r)},n)})})};e.fn.isVisible=function(){return !(e(this).css("visibility")=="hidden"||e(this).css("display")=="none")};e.fn.sortOptions=function(){return this.each(function(){e(this).append(e(this).find("option").remove().sort(function(o,n){var m=e(o).text(),p=e(n).text();return(m>p)?1:((m<p)?-1:0)}))})};var d=(function(){var m=0;return function(o,n){clearTimeout(m);m=setTimeout(o,n)}})()})(jQuery);